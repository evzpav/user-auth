server {

    listen               80;

    root /etc/nginx/resources/;

    # allow POST on static files
    error_page  405     =200 $uri;

    location ~* /oauth2/token {
        rewrite ^.*$ /auth/auth2.json last;
    }

    location ~* /providers/(.*)/schemas/(.*)/types/(.*) {
        set $schema_id $1-$2-$3;
        rewrite ^.*$ /schema/schema_$schema_id.json last;
    }

    # example of label-groups routes
    location ~* /label-groups/(.*) {
        if ($request_method = GET) {
            set $label_id $1;
            rewrite ^.*$ /labels/labels_get_$label_id.json;
        }

        if ($request_method = PUT) {
            set $label_id $1;
            rewrite ^.*$ /labels/labels_put_$label_id.json;
        }
    }

    # example of label-groups routes
    location ~* /label-groups {
        if ($request_method = POST) {
            rewrite ^.*$ /labels/labels_post.json last;
        }
    }

    # access-control
    location ~* /lib/access-control/allowed {
        if ($request_method = POST) {
            rewrite ^.*$ /access_control/access_control_post.json last;
        }
    }

    location /nginx_status {
        stub_status on;
        access_log   off;
        allow all;
    }
}